<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Araraazul</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;display:flex;transition:background .3s,color .3s;}

body.dark{background:#060B14;color:#E4EEFF;--s1:#0B1628;--s2:#0F1E35;--border:#1A2D45;--muted:#3D5A7A;--ibg:#060B14;--sidebar:#080E1C;}
body.light{background:#EEF2F8;color:#0A1628;--s1:#FFFFFF;--s2:#F4F7FC;--border:#C8D5E8;--muted:#6B88A8;--ibg:#F8FAFD;--sidebar:#1A2D45;}

/* SIDEBAR */
.sidebar{width:220px;min-height:100vh;background:var(--sidebar);display:flex;flex-direction:column;padding:24px 16px;flex-shrink:0;position:fixed;top:0;left:0;height:100vh;z-index:100;transition:background .3s;}
body.light .sidebar{background:#0F1E35;}

.sb-logo{display:flex;align-items:center;gap:10px;padding:0 4px;margin-bottom:32px;}
.sb-logo-box{width:38px;height:38px;background:linear-gradient(135deg,#00D4A0,#0066FF);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:800;color:#fff;flex-shrink:0;}
.sb-logo-name{font-size:14px;font-weight:800;color:#fff;line-height:1.2;}
.sb-logo-sub{font-size:9px;color:rgba(255,255,255,.4);font-family:'DM Mono',monospace;margin-top:1px;}

.sb-section{font-size:9px;color:rgba(255,255,255,.3);letter-spacing:2px;text-transform:uppercase;font-family:'DM Mono',monospace;padding:0 8px;margin-bottom:8px;margin-top:16px;}

.sb-item{display:flex;align-items:center;gap:10px;padding:11px 12px;border-radius:10px;cursor:pointer;transition:all .2s;color:rgba(255,255,255,.5);font-size:13px;font-weight:600;border:none;background:transparent;width:100%;text-align:left;font-family:'Plus Jakarta Sans',sans-serif;}
.sb-item:hover{background:rgba(255,255,255,.07);color:rgba(255,255,255,.85);}
.sb-item.active{background:linear-gradient(135deg,rgba(0,212,160,.2),rgba(0,102,255,.15));color:#fff;border:1px solid rgba(0,212,160,.2);}
.sb-item.active .sb-ico{color:#00D4A0;}
.sb-ico{font-size:16px;flex-shrink:0;width:20px;text-align:center;}
.sb-badge{margin-left:auto;background:#FF3B5C;color:#fff;font-size:9px;font-weight:800;padding:2px 6px;border-radius:20px;font-family:'DM Mono',monospace;}

.sb-bottom{margin-top:auto;border-top:1px solid rgba(255,255,255,.08);padding-top:16px;}
.sb-clock{font-family:'DM Mono',monospace;font-size:10px;color:rgba(255,255,255,.3);padding:0 12px;margin-bottom:12px;}
.btn-theme{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:transparent;color:rgba(255,255,255,.6);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;width:100%;transition:all .2s;}
.btn-theme:hover{background:rgba(255,255,255,.08);color:#fff;}

/* MAIN */
.main{margin-left:220px;flex:1;padding:28px;min-height:100vh;}

/* PAGE HEADER */
.page-header{margin-bottom:24px;padding-bottom:18px;border-bottom:1px solid var(--border);}
.page-title{font-size:22px;font-weight:800;letter-spacing:-.5px;}
.page-title span{background:linear-gradient(90deg,#00D4A0,#0066FF);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.page-sub{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;margin-top:4px;}

/* EMPRESA BAR */
.empresa{background:linear-gradient(135deg,rgba(0,212,160,.08),rgba(0,102,255,.08));border:1px solid var(--border);border-radius:14px;padding:12px 18px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;}
.ename{font-size:13px;font-weight:700;} .ename span{color:#00D4A0;}
.etag{font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;margin-top:2px;}

/* NOTIF */
.notif{background:rgba(255,59,92,.08);border:1px solid rgba(255,59,92,.25);border-radius:12px;padding:12px 16px;margin-bottom:18px;display:none;gap:12px;}
.notif.show{display:flex;}
.notif-title{font-size:11px;font-weight:700;color:#FF3B5C;margin-bottom:3px;}
.notif-item{font-size:12px;color:var(--muted);margin-top:2px;}

/* STATS */
.stats{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:22px;}
.stat{background:var(--s1);border:1px solid var(--border);border-radius:13px;padding:16px;position:relative;overflow:hidden;transition:transform .2s;}
.stat:hover{transform:translateY(-2px);}
.stat::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.c1::before{background:linear-gradient(90deg,#00D4A0,#00A87D);}
.c2::before{background:linear-gradient(90deg,#0066FF,#0044CC);}
.c3::before{background:linear-gradient(90deg,#FFB800,#E09900);}
.c4::before{background:linear-gradient(90deg,#FF3B5C,#CC2244);}
.c5::before{background:linear-gradient(90deg,#A855F7,#7C3AED);}
.stat-ico{font-size:18px;margin-bottom:8px;display:block;}
.stat-lbl{font-size:9px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:4px;font-family:'DM Mono',monospace;}
.stat-val{font-size:28px;font-weight:800;letter-spacing:-1px;}
.c1 .stat-val{color:#00D4A0;} .c2 .stat-val{color:#0066FF;}
.c3 .stat-val{color:#FFB800;} .c4 .stat-val{color:#FF3B5C;}
.c5 .stat-val{color:#A855F7;}

/* FILTROS */
.filtros{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px;align-items:center;}
.flbl{font-size:9px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px;}
.fb{padding:5px 12px;border-radius:20px;border:1px solid var(--border);background:var(--s1);color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;}
.fb:hover{border-color:#00D4A0;color:#00D4A0;}
.fb.on{background:#00D4A0;border-color:#00D4A0;color:#fff;}
.fb.on.fy{background:#FFB800;border-color:#FFB800;}
.fb.on.fr{background:#FF3B5C;border-color:#FF3B5C;}
.fb.on.fb2{background:#0066FF;border-color:#0066FF;}
.fb.on.fp{background:#A855F7;border-color:#A855F7;}

/* AGENDA GRID */
.agenda-grid{display:grid;grid-template-columns:320px 1fr;gap:18px;}

/* PANEL */
.panel{background:var(--s1);border:1px solid var(--border);border-radius:16px;padding:22px;height:fit-content;position:sticky;top:20px;}
.ptitle{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#00D4A0;margin-bottom:18px;display:flex;align-items:center;gap:8px;}
.pulse{width:7px;height:7px;background:#00D4A0;border-radius:50%;animation:pulse 2s infinite;}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(0,212,160,.4);}70%{box-shadow:0 0 0 8px rgba(0,212,160,0);}100%{box-shadow:0 0 0 0 rgba(0,212,160,0);}}

.field{margin-bottom:12px;}
.field label{display:block;font-size:9px;letter-spacing:1.5px;color:var(--muted);text-transform:uppercase;margin-bottom:5px;font-family:'DM Mono',monospace;}
.fi{width:100%;background:var(--ibg);border:1px solid var(--border);border-radius:9px;padding:10px 13px;color:inherit;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;outline:none;text-transform:uppercase;transition:border-color .2s;}
.fi:focus{border-color:#00D4A0;}
textarea.fi{resize:vertical;min-height:65px;}
body.dark input[type=date]::-webkit-calendar-picker-indicator{filter:invert(1);}

.prio-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:7px;}
.pb{padding:8px 0;border:1px solid var(--border);border-radius:8px;background:transparent;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;}
.pb.al{border-color:#00D4A0;background:rgba(0,212,160,.1);color:#00D4A0;}
.pb.am{border-color:#FFB800;background:rgba(255,184,0,.1);color:#FFB800;}
.pb.ah{border-color:#FF3B5C;background:rgba(255,59,92,.1);color:#FF3B5C;}

.status-row{display:grid;grid-template-columns:1fr 1fr;gap:7px;}
.sb{padding:8px 0;border:1px solid var(--border);border-radius:8px;background:transparent;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;text-align:center;}
.sb.sp.on{border-color:#FFB800;background:rgba(255,184,0,.1);color:#FFB800;}
.sb.sa.on{border-color:#0066FF;background:rgba(0,102,255,.1);color:#0066FF;}
.sb.sc.on{border-color:#00D4A0;background:rgba(0,212,160,.1);color:#00D4A0;}
.sb.sx.on{border-color:#FF3B5C;background:rgba(255,59,92,.1);color:#FF3B5C;}

.btn-save{width:100%;padding:13px;background:linear-gradient(135deg,#00D4A0,#0066FF);color:#fff;border:none;border-radius:11px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;letter-spacing:1px;text-transform:uppercase;cursor:pointer;margin-top:4px;transition:all .2s;box-shadow:0 4px 16px rgba(0,212,160,.25);}
.btn-save:hover{transform:translateY(-2px);}

/* LIST */
.ltop{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.ltitle{font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;}
.search{background:var(--s1);border:1px solid var(--border);border-radius:9px;padding:8px 13px;color:inherit;font-family:'DM Mono',monospace;font-size:12px;outline:none;width:175px;transition:border-color .2s;}
.search:focus{border-color:#00D4A0;}

.sdate{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;padding:6px 0;margin-bottom:6px;margin-top:12px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;}
.sdate:first-child{margin-top:0;}

.card{background:var(--s1);border:1px solid var(--border);border-radius:13px;padding:15px 17px;margin-bottom:9px;display:grid;grid-template-columns:4px 1fr auto;gap:13px;align-items:start;transition:border-color .2s,transform .2s;}
.card:hover{border-color:rgba(0,212,160,.2);transform:translateX(3px);}
.card.done{opacity:.6;}
.cstripe{border-radius:4px;}
.cname{font-size:14px;font-weight:700;margin-bottom:4px;}
.card.done .cname{text-decoration:line-through;color:var(--muted);}
.meta{display:flex;gap:5px;flex-wrap:wrap;align-items:center;margin-top:4px;}
.pill{font-family:'DM Mono',monospace;font-size:10px;padding:2px 8px;border-radius:20px;border:1px solid var(--border);color:var(--muted);}
.pill-urg{border-color:rgba(255,59,92,.4);color:#FF3B5C;background:rgba(255,59,92,.1);}
.pill-hj{border-color:rgba(255,184,0,.4);color:#FFB800;background:rgba(255,184,0,.1);}
.pill-low{border-color:rgba(0,212,160,.4);color:#00D4A0;background:rgba(0,212,160,.1);}
.pill-med{border-color:rgba(255,184,0,.4);color:#FFB800;background:rgba(255,184,0,.1);}
.pill-hi{border-color:rgba(255,59,92,.4);color:#FF3B5C;background:rgba(255,59,92,.1);}
.pill-resp{border-color:rgba(168,85,247,.4);color:#A855F7;background:rgba(168,85,247,.1);}
.cobs{font-size:11px;color:var(--muted);margin-top:6px;line-height:1.6;}

.sqrow{display:flex;gap:4px;margin-top:9px;flex-wrap:wrap;}
.sq{padding:4px 9px;border-radius:6px;border:1px solid;background:transparent;font-family:'Plus Jakarta Sans',sans-serif;font-size:10px;font-weight:700;cursor:pointer;transition:all .15s;}
.sq-p{border-color:#FFB800;color:#FFB800;} .sq-a{border-color:#0066FF;color:#0066FF;}
.sq-c{border-color:#00D4A0;color:#00D4A0;} .sq-x{border-color:#FF3B5C;color:#FF3B5C;}
.sq-p.cur{background:rgba(255,184,0,.15);} .sq-a.cur{background:rgba(0,102,255,.15);}
.sq-c.cur{background:rgba(0,212,160,.15);} .sq-x.cur{background:rgba(255,59,92,.15);}

.eform{margin-top:11px;padding-top:11px;border-top:1px solid var(--border);display:none;}
.eform.open{display:block;}
.erow{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:7px;}
.ei{width:100%;background:var(--ibg);border:1px solid var(--border);border-radius:8px;padding:8px 11px;color:inherit;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;outline:none;text-transform:uppercase;}
.ei:focus{border-color:#00D4A0;}
.eacts{display:flex;gap:7px;margin-top:7px;}
.btn-ok{padding:8px 14px;background:#00D4A0;color:#fff;border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;cursor:pointer;}
.btn-cx{padding:8px 11px;background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;cursor:pointer;}

.cacts{display:flex;flex-direction:column;gap:5px;}
.btn-wa{display:flex;align-items:center;gap:5px;background:rgba(37,211,102,.12);border:1px solid rgba(37,211,102,.3);color:#25D366;padding:6px 10px;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:700;text-decoration:none;white-space:nowrap;transition:all .2s;}
.btn-wa:hover{background:rgba(37,211,102,.22);}
.btn-ed,.btn-del{display:flex;align-items:center;gap:5px;background:transparent;border:1px solid var(--border);color:var(--muted);padding:5px 10px;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;cursor:pointer;white-space:nowrap;transition:all .2s;}
.btn-ed:hover{border-color:#0066FF;color:#0066FF;}
.btn-del:hover{border-color:#FF3B5C;color:#FF3B5C;}

.empty{background:var(--s1);border:1px dashed var(--border);border-radius:16px;padding:50px 20px;text-align:center;color:var(--muted);}

/* CALENDAR */
.cal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;}
.cal-nav{display:flex;align-items:center;gap:10px;}
.cal-title{font-size:16px;font-weight:800;}
.cal-btn{padding:6px 13px;border-radius:8px;border:1px solid var(--border);background:var(--s1);color:inherit;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;transition:all .2s;}
.cal-btn:hover{border-color:#00D4A0;}
.cal-dow-row,.cal-days{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;}
.cal-dow-row{margin-bottom:6px;}
.cal-dow{text-align:center;font-size:9px;font-family:'DM Mono',monospace;color:var(--muted);padding:5px 0;letter-spacing:1px;}
.cal-day{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:7px;min-height:90px;}
.cal-day.other{opacity:.3;}
.cal-day.today{border-color:#00D4A0;box-shadow:0 0 0 2px rgba(0,212,160,.12);}
.cal-num{font-size:12px;font-weight:700;color:var(--muted);margin-bottom:4px;}
.cal-day.today .cal-num{color:#00D4A0;}
.cal-ev{font-size:9px;padding:2px 5px;border-radius:4px;margin-bottom:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.cal-ev.low{background:rgba(0,212,160,.15);color:#00D4A0;}
.cal-ev.med{background:rgba(255,184,0,.15);color:#FFB800;}
.cal-ev.high{background:rgba(255,59,92,.15);color:#FF3B5C;}

/* CHARTS */
.charts-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.cbox{background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:20px;}
.ctitle{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);margin-bottom:16px;font-family:'DM Mono',monospace;}
.brow{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.blbl{font-size:11px;font-weight:600;min-width:80px;color:var(--muted);}
.btrack{flex:1;background:var(--s2);border-radius:6px;height:22px;overflow:hidden;}
.bfill{height:100%;border-radius:6px;display:flex;align-items:center;padding-left:8px;transition:width .8s ease;}
.bfill span{font-size:11px;font-weight:700;color:#fff;}
.bcnt{font-size:13px;font-weight:800;min-width:22px;text-align:right;}
.donut-wrap{display:flex;align-items:center;gap:20px;}
.donut{position:relative;width:120px;height:120px;flex-shrink:0;}
.donut svg{transform:rotate(-90deg);}
.donut-ctr{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;}
.donut-num{font-size:22px;font-weight:800;}
.donut-sub{font-size:10px;color:var(--muted);}
.leg{display:flex;flex-direction:column;gap:8px;}
.leg-row{display:flex;align-items:center;gap:8px;font-size:12px;}
.leg-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;}

/* CONFIG */
.config-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.config-box{background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:22px;}
.config-title{font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#00D4A0;margin-bottom:16px;font-family:'DM Mono',monospace;}
.config-row{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border);}
.config-row:last-child{border-bottom:none;}
.config-lbl{font-size:13px;font-weight:600;}
.config-sub{font-size:11px;color:var(--muted);margin-top:2px;}
.toggle{width:44px;height:24px;background:var(--border);border-radius:12px;position:relative;cursor:pointer;transition:background .2s;border:none;flex-shrink:0;}
.toggle.on{background:#00D4A0;}
.toggle::after{content:'';width:18px;height:18px;background:#fff;border-radius:50%;position:absolute;top:3px;left:3px;transition:left .2s;}
.toggle.on::after{left:23px;}
.btn-danger{padding:10px 18px;background:rgba(255,59,92,.1);border:1px solid rgba(255,59,92,.3);color:#FF3B5C;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s;}
.btn-danger:hover{background:rgba(255,59,92,.2);}
.btn-primary{padding:10px 18px;background:linear-gradient(135deg,#00D4A0,#0066FF);border:none;color:#fff;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s;}
.btn-primary:hover{transform:translateY(-1px);}
.version-tag{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-top:4px;}

/* PAGES */
.page{display:none;}
.page.active{display:block;}

/* TOAST */
.toast{position:fixed;bottom:28px;right:28px;padding:12px 20px;border-radius:11px;font-weight:700;font-size:13px;opacity:0;transform:translateY(12px);transition:all .3s;z-index:999;pointer-events:none;}
.toast.show{opacity:1;transform:translateY(0);}
.toast.ok{background:#00D4A0;color:#fff;}
.toast.err{background:#FF3B5C;color:#fff;}
.toast.info{background:#0066FF;color:#fff;}

@media(max-width:600px){
  .sidebar{width:100%;min-height:auto;height:auto;position:relative;flex-direction:row;padding:12px 16px;flex-wrap:wrap;gap:8px;}
  .sb-logo{margin-bottom:0;}
  .sb-section{display:none;}
  .sb-bottom{margin-top:0;border-top:none;padding-top:0;display:flex;align-items:center;gap:8px;}
  .main{margin-left:0;}
  body{flex-direction:column;}
}
@media(min-width:601px) and (max-width:900px){
  .sidebar{width:180px;}
  .stats{grid-template-columns:repeat(3,1fr);}
  .agenda-grid{grid-template-columns:1fr;}
  .charts-grid{grid-template-columns:1fr;}
  .config-grid{grid-template-columns:1fr;}
  .main{margin-left:180px;}
}
</style>
</head>
<body class="dark">

<!-- SIDEBAR -->
<nav class="sidebar">
  <div class="sb-logo">
    <div class="sb-logo-box">RN</div>
    <div>
      <div class="sb-logo-name">Araraazul</div>
      <div class="sb-logo-sub">ARARAAZUL</div>
    </div>
  </div>

  <div class="sb-section">MENU</div>
  <button class="sb-item active" onclick="goPage('agenda',this)">
    <span class="sb-ico">&#128203;</span>
    <span>Agenda</span>
    <span class="sb-badge" id="badge-urg">0</span>
  </button>
  <button class="sb-item" onclick="goPage('cal',this)">
    <span class="sb-ico">&#128197;</span>
    <span>Calendario</span>
  </button>
  <button class="sb-item" onclick="goPage('charts',this)">
    <span class="sb-ico">&#128202;</span>
    <span>Graficos</span>
  </button>

  <div class="sb-section">SISTEMA</div>
  <button class="sb-item" onclick="goPage('config',this)">
    <span class="sb-ico">&#9881;</span>
    <span>Configuracoes</span>
  </button>

  <div class="sb-bottom">
    <div class="sb-clock" id="clock">--:--:--</div>
    <button class="btn-theme" id="btn-theme" onclick="toggleTheme()">
      <span>&#9728;</span> <span>Tema Claro</span>
    </button>
  </div>
</nav>

<!-- MAIN CONTENT -->
<div class="main">

  <!-- PAGE: AGENDA -->
  <div class="page active" id="page-agenda">
    <div class="page-header">
      <div class="page-title">AGENDA <span>ARARAAZUL</span></div>
      <div class="page-sub">Excel&ecirc;ncia em Movimento &mdash; Araraazul &middot; Gestao de compromissos operacionais</div>
    </div>

    <div class="notif" id="notif">
      <div style="font-size:18px;flex-shrink:0">&#128276;</div>
      <div>
        <div class="notif-title">ATENCAO &mdash; COMPROMISSOS VENCIDOS OU URGENTES</div>
        <div id="notif-lista"></div>
      </div>
    </div>

    <div class="stats">
      <div class="stat c1"><span class="stat-ico">&#128203;</span><div class="stat-lbl">Total</div><div class="stat-val" id="s0">0</div></div>
      <div class="stat c2"><span class="stat-ico">&#8987;</span><div class="stat-lbl">Pendentes</div><div class="stat-val" id="s1">0</div></div>
      <div class="stat c3"><span class="stat-ico">&#9881;</span><div class="stat-lbl">Andamento</div><div class="stat-val" id="s2">0</div></div>
      <div class="stat c5"><span class="stat-ico">&#10003;</span><div class="stat-lbl">Concluidos</div><div class="stat-val" id="s3">0</div></div>
      <div class="stat c4"><span class="stat-ico">&#128680;</span><div class="stat-lbl">Urgentes/Venc</div><div class="stat-val" id="s4">0</div></div>
    </div>

    <div class="filtros">
      <span class="flbl">STATUS:</span>
      <button class="fb on" data-g="s" data-v="todos" onclick="setF(this)">Todos</button>
      <button class="fb" data-g="s" data-v="pend" onclick="setF(this)">Pendente</button>
      <button class="fb fb2" data-g="s" data-v="prog" onclick="setF(this)">Andamento</button>
      <button class="fb fp" data-g="s" data-v="conc" onclick="setF(this)">Concluido</button>
      <button class="fb fr" data-g="s" data-v="canc" onclick="setF(this)">Cancelado</button>
      <span class="flbl" style="margin-left:8px">PRIO:</span>
      <button class="fb on" data-g="p" data-v="todos" onclick="setF(this)">Todas</button>
      <button class="fb" data-g="p" data-v="low" onclick="setF(this)">Baixa</button>
      <button class="fb fy" data-g="p" data-v="med" onclick="setF(this)">Media</button>
      <button class="fb fr" data-g="p" data-v="high" onclick="setF(this)">Urgente</button>
      <span class="flbl" style="margin-left:8px">DATA:</span>
      <button class="fb on" data-g="d" data-v="todos" onclick="setF(this)">Todas</button>
      <button class="fb fy" data-g="d" data-v="hoje" onclick="setF(this)">Hoje</button>
      <button class="fb fr" data-g="d" data-v="venc" onclick="setF(this)">Vencidos</button>
    </div>

    <div class="agenda-grid">
      <div class="panel">
        <div class="ptitle"><div class="pulse"></div> Novo Agendamento</div>
        <div class="field"><label>Descricao *</label><input class="fi" type="text" id="i-tar" placeholder="EX: MANUTENCAO CARRO 1010"></div>
        <div class="field"><label>Responsavel *</label><input class="fi" type="text" id="i-resp" placeholder="EX: JOAO SILVA"></div>
        <div class="field"><label>Data *</label><input class="fi" type="date" id="i-data"></div>
        <div class="field"><label>WhatsApp (55+DDD+num) *</label><input class="fi" type="text" id="i-fone" placeholder="5561999999999" maxlength="15"></div>
        <div class="field"><label>Observacao</label><textarea class="fi" id="i-obs" placeholder="DETALHES (OPCIONAL)"></textarea></div>
        <div class="field">
          <label>Prioridade</label>
          <div class="prio-row">
            <button class="pb al" onclick="setPrio('low',this)">BAIXA</button>
            <button class="pb" onclick="setPrio('med',this)">MEDIA</button>
            <button class="pb" onclick="setPrio('high',this)">URGENTE</button>
          </div>
        </div>
        <div class="field">
          <label>Status</label>
          <div class="status-row">
            <button class="sb sp on" onclick="setSt('pend',this)">PENDENTE</button>
            <button class="sb sa" onclick="setSt('prog',this)">ANDAMENTO</button>
            <button class="sb sc" onclick="setSt('conc',this)">CONCLUIDO</button>
            <button class="sb sx" onclick="setSt('canc',this)">CANCELADO</button>
          </div>
        </div>
        <button class="btn-save" onclick="salvar()">+ SALVAR AGENDAMENTO</button>
      </div>

      <div>
        <div class="ltop">
          <div class="ltitle">Compromissos</div>
          <div style="display:flex;gap:8px">
            <input class="search" type="text" id="i-busca" placeholder="Buscar..." oninput="renderLista()">
            <button class="btn-ed" onclick="exportarPDF()" style="white-space:nowrap">Exportar PDF</button>
          </div>
        </div>
        <div id="lista"></div>
      </div>
    </div>
  </div>

  <!-- PAGE: CALENDARIO -->
  <div class="page" id="page-cal">
    <div class="page-header">
      <div class="page-title">CALEN<span>DARIO</span></div>
      <div class="page-sub">Visualizacao mensal dos compromissos agendados</div>
    </div>
    <div class="cal-header">
      <div class="cal-nav">
        <button class="cal-btn" onclick="navCal(-1)">&lsaquo;</button>
        <div class="cal-title" id="cal-title"></div>
        <button class="cal-btn" onclick="navCal(1)">&rsaquo;</button>
      </div>
      <button class="cal-btn" onclick="calHoje()">Hoje</button>
    </div>
    <div class="cal-dow-row">
      <div class="cal-dow">DOM</div><div class="cal-dow">SEG</div><div class="cal-dow">TER</div>
      <div class="cal-dow">QUA</div><div class="cal-dow">QUI</div><div class="cal-dow">SEX</div><div class="cal-dow">SAB</div>
    </div>
    <div class="cal-days" id="cal-days"></div>
  </div>

  <!-- PAGE: GRAFICOS -->
  <div class="page" id="page-charts">
    <div class="page-header">
      <div class="page-title">GRAFI<span>COS</span></div>
      <div class="page-sub">Relatorios e analises dos compromissos</div>
    </div>
    <div class="charts-grid">
      <div class="cbox"><div class="ctitle">Por Status</div><div id="ch-status"></div></div>
      <div class="cbox"><div class="ctitle">Por Prioridade</div><div id="ch-prio"></div></div>
      <div class="cbox"><div class="ctitle">Por Responsavel</div><div id="ch-resp"></div></div>
      <div class="cbox"><div class="ctitle">Resumo Geral</div><div class="donut-wrap" id="ch-donut"></div></div>
    </div>
  </div>

  <!-- PAGE: CONFIG -->
  <div class="page" id="page-config">
    <div class="page-header">
      <div class="page-title">CONFIGU<span>RACOES</span></div>
      <div class="page-sub">Preferencias e opcoes do sistema</div>
    </div>
    <div class="config-grid">
      <div class="config-box">
        <div class="config-title">Aparencia</div>
        <div class="config-row">
          <div><div class="config-lbl">Tema Escuro</div><div class="config-sub">Modo escuro para uso noturno</div></div>
          <button class="toggle on" id="tog-tema" onclick="toggleThemeBtn(this)"></button>
        </div>
        <div class="config-row">
          <div><div class="config-lbl">Notificacoes</div><div class="config-sub">Avisos de vencimento automaticos</div></div>
          <button class="toggle on" id="tog-notif" onclick="this.classList.toggle('on')"></button>
        </div>
      </div>

      <div class="config-box">
        <div class="config-title">Dados</div>
        <div class="config-row">
          <div>
            <div class="config-lbl">Exportar todos os dados</div>
            <div class="config-sub">Gera PDF com todos os registros</div>
          </div>
          <button class="btn-primary" onclick="exportarPDF()">Exportar PDF</button>
        </div>
        <div class="config-row">
          <div>
            <div class="config-lbl">Limpar todos os dados</div>
            <div class="config-sub">Remove todos os agendamentos permanentemente</div>
          </div>
          <button class="btn-danger" onclick="limparDados()">Limpar tudo</button>
        </div>
      </div>

      <div class="config-box">
        <div class="config-title">Sobre o Sistema</div>
        <div class="config-row">
          <div><div class="config-lbl">Versao</div><div class="version-tag">AGENDA ARARAAZUL v5.0</div></div>
        </div>
        <div class="config-row">
          <div><div class="config-lbl">Empresa</div><div class="config-sub">Excel&ecirc;ncia em Movimento &mdash; Araraazul</div></div>
        </div>
        <div class="config-row">
          <div><div class="config-lbl">Total de registros</div></div>
          <strong id="cfg-total" style="color:#00D4A0;font-size:20px;font-weight:800">0</strong>
        </div>
      </div>

      <div class="config-box">
        <div class="config-title">Legenda de Status</div>
        <div class="config-row"><div style="display:flex;align-items:center;gap:10px"><div style="width:10px;height:10px;border-radius:50%;background:#FFB800"></div><div class="config-lbl">Pendente</div></div><div class="config-sub">Aguardando inicio</div></div>
        <div class="config-row"><div style="display:flex;align-items:center;gap:10px"><div style="width:10px;height:10px;border-radius:50%;background:#0066FF"></div><div class="config-lbl">Andamento</div></div><div class="config-sub">Em execucao</div></div>
        <div class="config-row"><div style="display:flex;align-items:center;gap:10px"><div style="width:10px;height:10px;border-radius:50%;background:#00D4A0"></div><div class="config-lbl">Concluido</div></div><div class="config-sub">Finalizado com sucesso</div></div>
        <div class="config-row"><div style="display:flex;align-items:center;gap:10px"><div style="width:10px;height:10px;border-radius:50%;background:#FF3B5C"></div><div class="config-lbl">Cancelado</div></div><div class="config-sub">Nao sera realizado</div></div>
      </div>
    </div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
var KEY = 'AGENDA_ARARAAZUL_v5';
var prioAt = 'low', statAt = 'pend', dark = true;
var fS = 'todos', fP = 'todos', fD = 'todos';
var calY = new Date().getFullYear(), calM = new Date().getMonth();

var PC = {low:'#00D4A0', med:'#FFB800', high:'#FF3B5C'};
var SC = {pend:'#FFB800', prog:'#0066FF', conc:'#00D4A0', canc:'#FF3B5C'};
var SL = {pend:'PENDENTE', prog:'ANDAMENTO', conc:'CONCLUIDO', canc:'CANCELADO'};
var PL = {low:'BAIXA', med:'MEDIA', high:'URGENTE'};

function get() { try { return JSON.parse(localStorage.getItem(KEY)) || []; } catch(e) { return []; } }
function save(d) { localStorage.setItem(KEY, JSON.stringify(d)); }
function dias(ds) { var h = new Date(); h.setHours(0,0,0,0); return Math.round((new Date(ds+'T00:00:00') - h) / 86400000); }
function fmt(ds) { if (!ds) return ''; var p = ds.split('-'); return p[2]+'/'+p[1]+'/'+p[0]; }
function pad(v) { return String(v).padStart(2,'0'); }

setInterval(function() {
  var n = new Date();
  document.getElementById('clock').textContent = pad(n.getHours())+':'+pad(n.getMinutes())+':'+pad(n.getSeconds());
}, 1000);

function goPage(id, el) {
  document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
  document.querySelectorAll('.sb-item').forEach(function(b){ b.classList.remove('active'); });
  document.getElementById('page-'+id).classList.add('active');
  el.classList.add('active');
  if (id === 'cal') renderCal();
  if (id === 'charts') renderCharts();
  if (id === 'config') renderConfig();
}

function toggleTheme() {
  dark = !dark;
  document.body.className = dark ? 'dark' : 'light';
  var btn = document.getElementById('btn-theme');
  btn.innerHTML = dark ? '<span>&#9728;</span> <span>Tema Claro</span>' : '<span>&#9790;</span> <span>Tema Escuro</span>';
  var tog = document.getElementById('tog-tema');
  if (tog) { if (dark) tog.classList.add('on'); else tog.classList.remove('on'); }
}

function toggleThemeBtn(el) {
  el.classList.toggle('on');
  toggleTheme();
}

function setF(el) {
  var g = el.dataset.g, v = el.dataset.v;
  if (g === 's') fS = v;
  if (g === 'p') fP = v;
  if (g === 'd') fD = v;
  document.querySelectorAll('.fb[data-g="'+g+'"]').forEach(function(b){ b.classList.remove('on'); });
  el.classList.add('on');
  renderLista();
}

function setPrio(v, el) {
  prioAt = v;
  document.querySelectorAll('.pb').forEach(function(b){ b.className = 'pb'; });
  el.classList.add(v === 'low' ? 'al' : v === 'med' ? 'am' : 'ah');
}

function setSt(v, el) {
  statAt = v;
  document.querySelectorAll('.sb').forEach(function(b){ b.classList.remove('on'); });
  el.classList.add('on');
}

function toast(msg, tipo) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast ' + (tipo || 'ok') + ' show';
  setTimeout(function(){ t.classList.remove('show'); }, 2800);
}

function updateStats() {
  var dados = get();
  var st = {pend:0, prog:0, conc:0, canc:0};
  dados.forEach(function(i){ st[i.status] = (st[i.status]||0) + 1; });
  var urg = dados.filter(function(i){ return (dias(i.data) < 0 || i.prio === 'high') && i.status !== 'conc' && i.status !== 'canc'; }).length;
  document.getElementById('s0').textContent = dados.length;
  document.getElementById('s1').textContent = st.pend || 0;
  document.getElementById('s2').textContent = st.prog || 0;
  document.getElementById('s3').textContent = st.conc || 0;
  document.getElementById('s4').textContent = urg;
  document.getElementById('badge-urg').textContent = urg;

  var nb = document.getElementById('notif');
  var urg2 = dados.filter(function(i){ return dias(i.data) <= 1 && dias(i.data) >= -3 && i.status !== 'conc' && i.status !== 'canc'; });
  if (urg2.length) {
    nb.classList.add('show');
    document.getElementById('notif-lista').innerHTML = urg2.map(function(i){
      var d = dias(i.data);
      var lbl = d < 0 ? ('Vencido '+Math.abs(d)+'d') : d === 0 ? 'HOJE' : 'AMANHA';
      return '<div class="notif-item">- '+i.tarefa+(i.resp ? ' ('+i.resp+')' : '')+' - <strong>'+lbl+'</strong></div>';
    }).join('');
  } else { nb.classList.remove('show'); }
}

function salvar() {
  var t = document.getElementById('i-tar').value.trim().toUpperCase();
  var r = document.getElementById('i-resp').value.trim().toUpperCase();
  var d = document.getElementById('i-data').value;
  var f = document.getElementById('i-fone').value.trim().replace(/\D/g,'');
  var o = document.getElementById('i-obs').value.trim().toUpperCase();
  if (!t || !r || !d || !f) { toast('Preencha todos os campos', 'err'); return; }
  if (f.length < 10) { toast('Numero de telefone invalido', 'err'); return; }
  var dados = get();
  dados.push({tarefa:t, resp:r, data:d, fone:f, obs:o, prio:prioAt, status:statAt, criado:new Date().toISOString()});
  save(dados);
  document.getElementById('i-tar').value = '';
  document.getElementById('i-resp').value = '';
  document.getElementById('i-data').value = '';
  document.getElementById('i-fone').value = '';
  document.getElementById('i-obs').value = '';
  setPrio('low', document.querySelector('.pb'));
  setSt('pend', document.querySelector('.sb'));
  toast('Agendamento salvo!', 'ok');
  renderLista();
}

function mudarStatus(idx, s) {
  var dados = get(); dados[idx].status = s; save(dados);
  toast('Status: '+SL[s], 'info'); renderLista();
}

function apagar(idx) {
  if (!confirm('Excluir este agendamento?')) return;
  var dados = get(); dados.splice(idx, 1); save(dados);
  toast('Excluido', 'info'); renderLista();
}

function toggleEdit(idx) {
  var f = document.getElementById('ef-'+idx);
  var open = f.classList.contains('open');
  document.querySelectorAll('.eform.open').forEach(function(x){ x.classList.remove('open'); });
  if (!open) f.classList.add('open');
}

function confirmarEdit(idx) {
  var dados = get();
  var t = document.getElementById('et-'+idx).value.trim().toUpperCase();
  var r = document.getElementById('er-'+idx).value.trim().toUpperCase();
  var d = document.getElementById('ed-'+idx).value;
  var f = document.getElementById('ef2-'+idx).value.trim().replace(/\D/g,'');
  var o = document.getElementById('eo-'+idx).value.trim().toUpperCase();
  var p = document.getElementById('ep-'+idx).value;
  var s = document.getElementById('es-'+idx).value;
  if (!t || !r || !d || !f) { toast('Preencha todos os campos', 'err'); return; }
  dados[idx] = Object.assign({}, dados[idx], {tarefa:t, resp:r, data:d, fone:f, obs:o, prio:p, status:s});
  save(dados); toast('Atualizado!', 'ok'); renderLista();
}

function limparDados() {
  if (!confirm('Tem certeza? Todos os dados serao apagados permanentemente!')) return;
  localStorage.removeItem(KEY);
  toast('Dados apagados', 'info');
  renderLista();
  renderConfig();
}

function exportarPDF() {
  var dados = get();
  if (!dados.length) { toast('Nenhum dado', 'err'); return; }
  var rows = dados.map(function(i, n){
    return '<tr style="border-bottom:1px solid #eee"><td style="padding:8px">'+(n+1)+'</td><td style="padding:8px;font-weight:700">'+i.tarefa+'</td><td style="padding:8px">'+(i.resp||'-')+'</td><td style="padding:8px">'+fmt(i.data)+'</td><td style="padding:8px">'+(SL[i.status]||'-')+'</td><td style="padding:8px">'+(PL[i.prio]||'-')+'</td><td style="padding:8px;font-size:11px;color:#666">'+(i.obs||'-')+'</td></tr>';
  }).join('');
  var w = window.open('','_blank');
  w.document.write('<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Agenda Araraazul</title><style>body{font-family:sans-serif;padding:32px}table{width:100%;border-collapse:collapse}th{background:#060B14;color:#fff;padding:9px;text-align:left;font-size:11px}h2{margin-bottom:4px}p{color:#666;margin-bottom:20px}</style></head><body><h2>AGENDA ARARAAZUL - ARARAAZUL</h2><p>Emitido em '+new Date().toLocaleDateString('pt-BR')+'</p><table><thead><tr><th>#</th><th>TAREFA</th><th>RESPONSAVEL</th><th>DATA</th><th>STATUS</th><th>PRIORIDADE</th><th>OBSERVACAO</th></tr></thead><tbody>'+rows+'</tbody></table></body></html>');
  w.document.close(); w.print();
  toast('Abrindo PDF', 'ok');
}

function renderConfig() {
  var dados = get();
  var el = document.getElementById('cfg-total');
  if (el) el.textContent = dados.length;
}

function navCal(d) {
  calM += d;
  if (calM > 11) { calM = 0; calY++; }
  if (calM < 0) { calM = 11; calY--; }
  renderCal();
}

function calHoje() {
  calY = new Date().getFullYear(); calM = new Date().getMonth(); renderCal();
}

function renderCal() {
  var meses = ['Janeiro','Fevereiro','Marco','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
  document.getElementById('cal-title').textContent = meses[calM]+' '+calY;
  var dados = get();
  var hoje = new Date(); hoje.setHours(0,0,0,0);
  var primeiro = new Date(calY, calM, 1);
  var ultimo = new Date(calY, calM+1, 0);
  var inicio = primeiro.getDay();
  var html = '';
  for (var i = 0; i < inicio; i++) {
    var dd = new Date(calY, calM, -(inicio-1-i));
    html += '<div class="cal-day other"><div class="cal-num">'+dd.getDate()+'</div></div>';
  }
  for (var d = 1; d <= ultimo.getDate(); d++) {
    var dt = new Date(calY, calM, d);
    var ds = calY+'-'+pad(calM+1)+'-'+pad(d);
    var isHoje = dt.getTime() === hoje.getTime();
    var evts = dados.filter(function(x){ return x.data === ds; });
    var evHtml = evts.slice(0,3).map(function(x){ return '<div class="cal-ev '+x.prio+'">'+x.tarefa.slice(0,14)+'</div>'; }).join('');
    var mais = evts.length > 3 ? '<div style="font-size:9px;color:var(--muted)">+'+(evts.length-3)+' mais</div>' : '';
    html += '<div class="cal-day'+(isHoje?' today':'')+'"><div class="cal-num">'+d+'</div>'+evHtml+mais+'</div>';
  }
  var resto = (7 - ((inicio + ultimo.getDate()) % 7)) % 7;
  for (var j = 1; j <= resto; j++) html += '<div class="cal-day other"><div class="cal-num">'+j+'</div></div>';
  document.getElementById('cal-days').innerHTML = html;
}

function renderCharts() {
  var dados = get();
  var ss = {pend:0, prog:0, conc:0, canc:0};
  var pp = {low:0, med:0, high:0};
  var rr = {};
  dados.forEach(function(i){
    ss[i.status] = (ss[i.status]||0) + 1;
    pp[i.prio] = (pp[i.prio]||0) + 1;
    var r = i.resp || 'N/A'; rr[r] = (rr[r]||0) + 1;
  });
  var maxS = Math.max.apply(null, [ss.pend,ss.prog,ss.conc,ss.canc,1]);
  document.getElementById('ch-status').innerHTML =
    [['pend','Pendente','#FFB800'],['prog','Andamento','#0066FF'],['conc','Concluido','#00D4A0'],['canc','Cancelado','#FF3B5C']].map(function(x){
      return '<div class="brow"><div class="blbl">'+x[1]+'</div><div class="btrack"><div class="bfill" style="width:'+(ss[x[0]]/maxS*100)+'%;background:'+x[2]+'"><span>'+ss[x[0]]+'</span></div></div><div class="bcnt" style="color:'+x[2]+'">'+ss[x[0]]+'</div></div>';
    }).join('');
  var maxP = Math.max.apply(null, [pp.low,pp.med,pp.high,1]);
  document.getElementById('ch-prio').innerHTML =
    [['low','Baixa','#00D4A0'],['med','Media','#FFB800'],['high','Urgente','#FF3B5C']].map(function(x){
      return '<div class="brow"><div class="blbl">'+x[1]+'</div><div class="btrack"><div class="bfill" style="width:'+(pp[x[0]]/maxP*100)+'%;background:'+x[2]+'"><span>'+pp[x[0]]+'</span></div></div><div class="bcnt" style="color:'+x[2]+'">'+pp[x[0]]+'</div></div>';
    }).join('');
  var sortR = Object.entries(rr).sort(function(a,b){ return b[1]-a[1]; }).slice(0,6);
  var maxR = Math.max.apply(null, sortR.map(function(x){ return x[1]; }).concat([1]));
  document.getElementById('ch-resp').innerHTML = sortR.length ?
    sortR.map(function(x){ return '<div class="brow"><div class="blbl" style="font-size:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:80px">'+x[0]+'</div><div class="btrack"><div class="bfill" style="width:'+(x[1]/maxR*100)+'%;background:linear-gradient(90deg,#A855F7,#7C3AED)"><span>'+x[1]+'</span></div></div><div class="bcnt" style="color:#A855F7">'+x[1]+'</div></div>'; }).join('') :
    '<div style="color:var(--muted);text-align:center;padding:20px;font-size:12px">Nenhum dado</div>';
  var total = dados.length || 1;
  var pct = Math.round((ss.conc||0)/total*100);
  var R = 52, C = 2*Math.PI*R;
  var d1 = (ss.conc||0)/total*C, d2 = (ss.prog||0)/total*C, d3 = (ss.pend||0)/total*C, d4 = (ss.canc||0)/total*C;
  document.getElementById('ch-donut').innerHTML =
    '<div class="donut"><svg width="120" height="120" viewBox="0 0 120 120"><circle cx="60" cy="60" r="'+R+'" fill="none" stroke="var(--s2)" stroke-width="12"/><circle cx="60" cy="60" r="'+R+'" fill="none" stroke="#00D4A0" stroke-width="12" stroke-dasharray="'+d1+' '+(C-d1)+'" stroke-dashoffset="0"/><circle cx="60" cy="60" r="'+R+'" fill="none" stroke="#0066FF" stroke-width="12" stroke-dasharray="'+d2+' '+(C-d2)+'" stroke-dashoffset="'+(-d1)+'"/><circle cx="60" cy="60" r="'+R+'" fill="none" stroke="#FFB800" stroke-width="12" stroke-dasharray="'+d3+' '+(C-d3)+'" stroke-dashoffset="'+(-(d1+d2))+'"/><circle cx="60" cy="60" r="'+R+'" fill="none" stroke="#FF3B5C" stroke-width="12" stroke-dasharray="'+d4+' '+(C-d4)+'" stroke-dashoffset="'+(-(d1+d2+d3))+'"/></svg><div class="donut-ctr"><div class="donut-num">'+pct+'%</div><div class="donut-sub">Concluido</div></div></div>'+
    '<div class="leg">'+[['#00D4A0','Concluido',ss.conc||0],['#0066FF','Andamento',ss.prog||0],['#FFB800','Pendente',ss.pend||0],['#FF3B5C','Cancelado',ss.canc||0]].map(function(x){ return '<div class="leg-row"><div class="leg-dot" style="background:'+x[0]+'"></div><span style="flex:1;color:var(--muted)">'+x[1]+'</span><strong>'+x[2]+'</strong></div>'; }).join('')+'</div>';
}

function renderLista() {
  updateStats();
  var dados = get();
  var busca = document.getElementById('i-busca').value.toLowerCase();
  var filtrados = dados.map(function(item, i){ return Object.assign({}, item, {oi:i}); }).filter(function(i){
    if (busca && i.tarefa.toLowerCase().indexOf(busca) < 0 && (i.resp||'').toLowerCase().indexOf(busca) < 0 && (i.obs||'').toLowerCase().indexOf(busca) < 0) return false;
    if (fS !== 'todos' && i.status !== fS) return false;
    if (fP !== 'todos' && i.prio !== fP) return false;
    if (fD === 'hoje' && dias(i.data) !== 0) return false;
    if (fD === 'venc' && dias(i.data) >= 0) return false;
    return true;
  }).sort(function(a,b){ return a.data.localeCompare(b.data); });

  var lista = document.getElementById('lista');
  if (!filtrados.length) { lista.innerHTML = '<div class="empty"><div style="font-size:38px;opacity:.3;margin-bottom:10px">&#128203;</div><p style="font-size:13px">NENHUM COMPROMISSO ENCONTRADO</p></div>'; return; }

  var lastDate = '', html = '';
  filtrados.forEach(function(item) {
    var d = dias(item.data);
    var dLabel = d < 0 ? ('Vencido '+Math.abs(d)+'d') : d === 0 ? 'HOJE' : d === 1 ? 'AMANHA' : ('Em '+d+'d');
    var dCls = d < 0 ? 'pill-urg' : d === 0 ? 'pill-hj' : '';
    var sc = item.status === 'conc' ? '#3D5A7A' : (PC[item.prio]||'#00D4A0');
    var stCol = SC[item.status]||'#FFB800';
    var pCls = item.prio === 'high' ? 'pill-hi' : item.prio === 'med' ? 'pill-med' : 'pill-low';
    var msg = encodeURIComponent('AVISO - ARARAAZUL\n\nTAREFA: '+item.tarefa+'\nRESPONSAVEL: '+(item.resp||'-')+'\n'+(item.obs?'DETALHE: '+item.obs+'\n':'')+'PRAZO: '+fmt(item.data)+'\nSTATUS: '+(SL[item.status]||'-'));
    var link = 'https://wa.me/'+item.fone+'?text='+msg;
    var idx = item.oi;

    if (item.data !== lastDate) {
      html += '<div class="sdate"><span>'+fmt(item.data)+'</span><span>'+dLabel+'</span></div>';
      lastDate = item.data;
    }

    html += '<div class="card'+(item.status==='conc'?' done':'')+'"><div class="cstripe" style="background:'+sc+'"></div><div style="min-width:0"><div class="cname">'+item.tarefa+'</div><div class="meta">'+(dCls?'<span class="pill '+dCls+'">'+dLabel+'</span>':'')+'<span class="pill pill-resp">Resp: '+(item.resp||'N/A')+'</span><span class="pill" style="border-color:'+stCol+'44;color:'+stCol+';background:'+stCol+'18">'+(SL[item.status]||'-')+'</span><span class="pill '+pCls+'">'+(PL[item.prio]||'-')+'</span></div>'+(item.obs?'<div class="cobs">'+item.obs+'</div>':'');
    html += '<div class="sqrow"><button class="sq sq-p'+(item.status==='pend'?' cur':'')+'" onclick="mudarStatus('+idx+',\'pend\')">Pend</button><button class="sq sq-a'+(item.status==='prog'?' cur':'')+'" onclick="mudarStatus('+idx+',\'prog\')">Andam</button><button class="sq sq-c'+(item.status==='conc'?' cur':'')+'" onclick="mudarStatus('+idx+',\'conc\')">Concl</button><button class="sq sq-x'+(item.status==='canc'?' cur':'')+'" onclick="mudarStatus('+idx+',\'canc\')">Canc</button></div>';
    html += '<div class="eform" id="ef-'+idx+'"><div class="erow"><input class="ei" id="et-'+idx+'" value="'+item.tarefa+'" placeholder="TAREFA" style="grid-column:1/-1"></div><div class="erow"><input class="ei" id="er-'+idx+'" value="'+(item.resp||'')+'" placeholder="RESPONSAVEL"><input type="date" class="ei" id="ed-'+idx+'" value="'+item.data+'"></div><div class="erow"><input class="ei" id="ef2-'+idx+'" value="'+item.fone+'" placeholder="WHATSAPP"><select class="ei" id="ep-'+idx+'"><option value="low"'+(item.prio==='low'?' selected':'')+'>BAIXA</option><option value="med"'+(item.prio==='med'?' selected':'')+'>MEDIA</option><option value="high"'+(item.prio==='high'?' selected':'')+'>URGENTE</option></select></div><select class="ei" id="es-'+idx+'" style="width:100%;margin-bottom:8px"><option value="pend"'+(item.status==='pend'?' selected':'')+'>PENDENTE</option><option value="prog"'+(item.status==='prog'?' selected':'')+'>ANDAMENTO</option><option value="conc"'+(item.status==='conc'?' selected':'')+'>CONCLUIDO</option><option value="canc"'+(item.status==='canc'?' selected':'')+'>CANCELADO</option></select><input class="ei" id="eo-'+idx+'" value="'+(item.obs||'')+'" placeholder="OBS" style="width:100%;margin-bottom:8px"><div class="eacts"><button class="btn-ok" onclick="confirmarEdit('+idx+')">SALVAR</button><button class="btn-cx" onclick="toggleEdit('+idx+')">CANCELAR</button></div></div>';
    html += '</div><div class="cacts"><a href="'+link+'" target="_blank" class="btn-wa">WhatsApp</a><button class="btn-ed" onclick="toggleEdit('+idx+')">Editar</button><button class="btn-del" onclick="apagar('+idx+')">Excluir</button></div></div>';
  });
  lista.innerHTML = html;
}

window.onload = function() { renderLista(); };
</script>
</body>
</html>
