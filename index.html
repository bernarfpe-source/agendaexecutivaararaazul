
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Rio Novo ‚Äî Araraazul</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;}

body{
  font-family:'Plus Jakarta Sans',sans-serif;
  min-height:100vh; padding:28px;
  transition:background .3s,color .3s;
}

/* ‚îÄ‚îÄ TEMAS ‚îÄ‚îÄ */
body.dark{
  background:#060B14; color:#E4EEFF;
  --bg:#060B14; --s1:#0B1628; --s2:#0F1E35;
  --border:#1A2D45; --text:#E4EEFF; --muted:#3D5A7A;
  --ibg:#060B14; --accent:#00D4A0; --accent2:#0066FF;
}
body.light{
  background:#EEF2F8; color:#0A1628;
  --bg:#EEF2F8; --s1:#FFFFFF; --s2:#F4F7FC;
  --border:#C8D5E8; --text:#0A1628; --muted:#6B88A8;
  --ibg:#F8FAFD; --accent:#00A87D; --accent2:#0055DD;
}
body{ background-image: var(--grad,none); }
body.dark{ --grad: radial-gradient(ellipse 70% 50% at 90% 0%, rgba(0,102,255,0.06) 0%, transparent 60%), radial-gradient(ellipse 50% 40% at 5% 90%, rgba(0,212,160,0.05) 0%, transparent 60%); }

.wrap{max-width:1160px;margin:0 auto;}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.header{
  display:flex;align-items:center;justify-content:space-between;
  padding-bottom:22px;border-bottom:1px solid var(--border);margin-bottom:28px;
  animation: fadeDown .5s ease;
}
.header-brand{display:flex;align-items:center;gap:16px;}
.logo-box{
  width:48px;height:48px;background:linear-gradient(135deg,#00D4A0,#0066FF);
  border-radius:14px;display:flex;align-items:center;justify-content:center;
  font-size:18px;font-weight:800;color:#fff;
  box-shadow:0 4px 16px rgba(0,212,160,0.3);
  flex-shrink:0;
}
.brand-name{font-size:21px;font-weight:800;letter-spacing:-.5px;}
.brand-name span{background:linear-gradient(90deg,#00D4A0,#0066FF);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.brand-sub{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;margin-top:2px;letter-spacing:.5px;}
.header-right{display:flex;align-items:center;gap:10px;}
.clock{
  font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);
  background:var(--s1);padding:6px 14px;border-radius:20px;border:1px solid var(--border);
  letter-spacing:.5px;
}
.btn-theme{
  display:flex;align-items:center;gap:8px;padding:8px 18px;border-radius:20px;
  border:1px solid var(--border);background:var(--s1);color:var(--text);
  cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;
  transition:all .2s;
}
.btn-theme:hover{border-color:var(--accent);color:var(--accent);}

/* ‚îÄ‚îÄ EMPRESA ‚îÄ‚îÄ */
.empresa-bar{
  background:linear-gradient(135deg,rgba(0,212,160,0.08),rgba(0,102,255,0.08));
  border:1px solid var(--border);border-radius:14px;padding:14px 22px;
  margin-bottom:24px;display:flex;align-items:center;justify-content:space-between;
  animation: fadeUp .5s ease .1s both;
}
.empresa-name{font-size:14px;font-weight:700;letter-spacing:.3px;}
.empresa-name span{color:var(--accent);}
.empresa-tag{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;}

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:26px;animation:fadeUp .5s ease .15s both;}
.stat{
  background:var(--s1);border:1px solid var(--border);border-radius:14px;
  padding:20px;position:relative;overflow:hidden;cursor:pointer;
  transition:transform .2s,border-color .2s,box-shadow .2s;
}
.stat:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.15);}
.stat::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.stat.c1::before{background:linear-gradient(90deg,#00D4A0,#00A87D);}
.stat.c2::before{background:linear-gradient(90deg,#0066FF,#0044CC);}
.stat.c3::before{background:linear-gradient(90deg,#FFB800,#E09900);}
.stat.c4::before{background:linear-gradient(90deg,#FF3B5C,#CC2244);}
.stat-icon{font-size:22px;margin-bottom:10px;display:block;}
.stat-label{font-size:10px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:6px;font-family:'DM Mono',monospace;}
.stat-val{font-size:34px;font-weight:800;letter-spacing:-1.5px;}
.stat.c1 .stat-val{color:#00D4A0;} .stat.c2 .stat-val{color:#0066FF;}
.stat.c3 .stat-val{color:#FFB800;} .stat.c4 .stat-val{color:#FF3B5C;}

/* ‚îÄ‚îÄ FILTROS ‚îÄ‚îÄ */
.filtros{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;animation:fadeUp .5s ease .2s both;}
.filtro-btn{
  padding:7px 16px;border-radius:20px;border:1px solid var(--border);
  background:var(--s1);color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;
  font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;
}
.filtro-btn.active{background:var(--accent);border-color:var(--accent);color:#fff;}
.filtro-btn:hover:not(.active){border-color:var(--accent);color:var(--accent);}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main{display:grid;grid-template-columns:340px 1fr;gap:20px;animation:fadeUp .5s ease .25s both;}

/* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
.panel{
  background:var(--s1);border:1px solid var(--border);border-radius:18px;
  padding:26px;height:fit-content;position:sticky;top:24px;
}
.panel-title{
  font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;
  color:var(--accent);margin-bottom:22px;display:flex;align-items:center;gap:10px;
}
.pulse{
  width:8px;height:8px;background:var(--accent);border-radius:50%;
  box-shadow:0 0 0 0 rgba(0,212,160,.4);
  animation:pulse 2s infinite;
}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(0,212,160,.4);}70%{box-shadow:0 0 0 8px rgba(0,212,160,0);}100%{box-shadow:0 0 0 0 rgba(0,212,160,0);}}

.field{margin-bottom:15px;}
.field label{display:block;font-size:10px;letter-spacing:1.5px;color:var(--muted);text-transform:uppercase;margin-bottom:7px;font-family:'DM Mono',monospace;}
.field input,.field textarea,.field select{
  width:100%;background:var(--ibg);border:1px solid var(--border);border-radius:10px;
  padding:12px 15px;color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;
  font-size:13px;outline:none;text-transform:uppercase;transition:border-color .2s,box-shadow .2s;
}
.field input:focus,.field textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,212,160,.1);}
.field textarea{resize:vertical;min-height:75px;}
body.dark input[type=date]::-webkit-calendar-picker-indicator{filter:invert(1);}

.prio-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}
.prio-btn{
  padding:10px 0;border:1px solid var(--border);border-radius:9px;
  background:transparent;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;
  font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;
}
.prio-btn.al{border-color:#00D4A0;background:rgba(0,212,160,.1);color:#00D4A0;}
.prio-btn.am{border-color:#FFB800;background:rgba(255,184,0,.1);color:#FFB800;}
.prio-btn.ah{border-color:#FF3B5C;background:rgba(255,59,92,.1);color:#FF3B5C;}

.btn-save{
  width:100%;padding:15px;background:linear-gradient(135deg,#00D4A0,#0066FF);
  color:#fff;border:none;border-radius:12px;font-family:'Plus Jakarta Sans',sans-serif;
  font-size:13px;font-weight:800;letter-spacing:1px;text-transform:uppercase;
  cursor:pointer;margin-top:6px;transition:all .2s;
  box-shadow:0 4px 16px rgba(0,212,160,.25);
}
.btn-save:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,212,160,.35);}
.btn-save:active{transform:translateY(0);}

/* ‚îÄ‚îÄ LISTA ‚îÄ‚îÄ */
.list-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.list-title{font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase;}
.list-actions{display:flex;gap:8px;}
.search{
  background:var(--s1);border:1px solid var(--border);border-radius:10px;
  padding:9px 14px;color:var(--text);font-family:'DM Mono',monospace;font-size:12px;
  outline:none;width:190px;transition:border-color .2s;
}
.search:focus{border-color:var(--accent);}
.btn-export{
  display:flex;align-items:center;gap:6px;padding:9px 14px;border-radius:10px;
  border:1px solid var(--border);background:var(--s1);color:var(--muted);
  font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:700;
  cursor:pointer;transition:all .2s;white-space:nowrap;
}
.btn-export:hover{border-color:var(--accent2);color:var(--accent2);}

.section-date{
  font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;
  text-transform:uppercase;padding:7px 0;margin-bottom:6px;margin-top:12px;
  border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;
}
.section-date:first-child{margin-top:0;}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card{
  background:var(--s1);border:1px solid var(--border);border-radius:14px;
  padding:18px 20px;margin-bottom:10px;
  display:grid;grid-template-columns:4px 1fr auto;gap:15px;align-items:start;
  transition:border-color .2s,transform .2s,box-shadow .2s;
  animation:slideIn .3s ease;
}
@keyframes slideIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
.card:hover{border-color:rgba(0,212,160,.25);transform:translateX(3px);box-shadow:0 4px 20px rgba(0,0,0,.12);}
.card.editing{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,212,160,.1);}
.card-stripe{border-radius:4px;}
.card-name{font-size:15px;font-weight:700;margin-bottom:5px;}
.meta-row{display:flex;gap:7px;flex-wrap:wrap;align-items:center;margin-top:5px;}
.pill{
  font-family:'DM Mono',monospace;font-size:10px;padding:3px 10px;
  border-radius:20px;border:1px solid var(--border);color:var(--muted);background:transparent;
}
.p-urg{border-color:rgba(255,59,92,.4);color:#FF3B5C;background:rgba(255,59,92,.1);}
.p-hj {border-color:rgba(255,184,0,.4);color:#FFB800;background:rgba(255,184,0,.1);}
.p-am {border-color:rgba(255,184,0,.3);color:#FFB800;background:rgba(255,184,0,.07);}
.p-low{border-color:rgba(0,212,160,.4);color:#00D4A0;background:rgba(0,212,160,.1);}
.p-med{border-color:rgba(255,184,0,.4);color:#FFB800;background:rgba(255,184,0,.1);}
.p-hi {border-color:rgba(255,59,92,.4);color:#FF3B5C;background:rgba(255,59,92,.1);}
.card-obs{font-size:12px;color:var(--muted);margin-top:7px;line-height:1.6;font-style:italic;}

/* EDIT INLINE */
.edit-form{margin-top:12px;padding-top:12px;border-top:1px solid var(--border);display:none;}
.edit-form.open{display:block;}
.edit-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;}
.edit-inp{
  width:100%;background:var(--ibg);border:1px solid var(--border);border-radius:8px;
  padding:9px 12px;color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;
  font-size:12px;outline:none;text-transform:uppercase;
}
.edit-inp:focus{border-color:var(--accent);}
.edit-actions{display:flex;gap:8px;margin-top:8px;}
.btn-confirm{padding:8px 18px;background:var(--accent);color:#fff;border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;cursor:pointer;}
.btn-cancel-edit{padding:8px 14px;background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;cursor:pointer;}

.card-actions{display:flex;flex-direction:column;gap:7px;align-items:flex-end;}
.btn-wa{
  display:flex;align-items:center;gap:6px;background:rgba(37,211,102,.12);
  border:1px solid rgba(37,211,102,.3);color:#25D366;padding:8px 13px;border-radius:9px;
  font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:700;
  text-decoration:none;white-space:nowrap;cursor:pointer;transition:all .2s;
}
.btn-wa:hover{background:rgba(37,211,102,.22);}
.btn-edit{
  display:flex;align-items:center;gap:5px;background:transparent;
  border:1px solid var(--border);color:var(--muted);padding:7px 12px;border-radius:9px;
  font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;cursor:pointer;
  white-space:nowrap;transition:all .2s;
}
.btn-edit:hover{border-color:var(--accent2);color:var(--accent2);}
.btn-del{
  display:flex;align-items:center;gap:5px;background:transparent;
  border:1px solid var(--border);color:var(--muted);padding:7px 12px;border-radius:9px;
  font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;cursor:pointer;
  white-space:nowrap;transition:all .2s;
}
.btn-del:hover{border-color:#FF3B5C;color:#FF3B5C;background:rgba(255,59,92,.07);}

/* ‚îÄ‚îÄ NOTIF BANNER ‚îÄ‚îÄ */
.notif-banner{
  background:linear-gradient(135deg,rgba(255,59,92,.1),rgba(255,184,0,.08));
  border:1px solid rgba(255,59,92,.25);border-radius:14px;padding:14px 20px;
  margin-bottom:20px;display:none;animation:fadeUp .4s ease;
}
.notif-banner.show{display:flex;align-items:flex-start;gap:12px;}
.notif-icon{font-size:20px;flex-shrink:0;}
.notif-content{flex:1;}
.notif-title{font-size:12px;font-weight:700;color:#FF3B5C;letter-spacing:.5px;margin-bottom:4px;}
.notif-item{font-size:12px;color:var(--muted);margin-top:3px;}

.empty{
  background:var(--s1);border:1px dashed var(--border);border-radius:18px;
  padding:60px 20px;text-align:center;color:var(--muted);
}
.empty-icon{font-size:42px;margin-bottom:14px;opacity:.35;}
.empty p{font-size:13px;letter-spacing:.5px;}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{
  position:fixed;bottom:28px;right:28px;padding:14px 24px;border-radius:12px;
  font-weight:700;font-size:13px;opacity:0;transform:translateY(12px);
  transition:all .3s;z-index:999;pointer-events:none;
  box-shadow:0 8px 24px rgba(0,0,0,.2);
}
.toast.show{opacity:1;transform:translateY(0);}
.toast.ok{background:linear-gradient(135deg,#00D4A0,#009970);color:#fff;}
.toast.err{background:linear-gradient(135deg,#FF3B5C,#CC2244);color:#fff;}
.toast.info{background:linear-gradient(135deg,#0066FF,#0044BB);color:#fff;}

/* ‚îÄ‚îÄ ANIMA√á√ïES ‚îÄ‚îÄ */
@keyframes fadeDown{from{opacity:0;transform:translateY(-12px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}

@media(max-width:900px){
  .main{grid-template-columns:1fr;}
  .stats{grid-template-columns:1fr 1fr;}
  .panel{position:static;}
  .header{flex-direction:column;align-items:flex-start;gap:12px;}
}
</style>
</head>
<body class="dark">
<div class="wrap">

  <!-- HEADER -->
  <div class="header">
    <div class="header-brand">
      <div class="logo-box">RN</div>
      <div>
        <div class="brand-name">AGENDA <span>RIO NOVO</span></div>
        <div class="brand-sub">SISTEMA OPERACIONAL DE COMPROMISSOS</div>
      </div>
    </div>
    <div class="header-right">
      <div class="clock" id="clock">--/--/---- ¬∑ --:--:--</div>
      <button class="btn-theme" onclick="toggleTheme()" id="btn-theme">‚òÄÔ∏è CLARO</button>
    </div>
  </div>

  <!-- EMPRESA -->
  <div class="empresa-bar">
    <div>
      <div class="empresa-name">Excel√™ncia em Movimento ‚Äî <span>Araraazul</span></div>
      <div class="empresa-tag">Gest√£o de compromissos operacionais</div>
    </div>
    <div style="font-size:28px;">üöå</div>
  </div>

  <!-- NOTIF VENCIMENTOS -->
  <div class="notif-banner" id="notif-banner">
    <div class="notif-icon">üîî</div>
    <div class="notif-content">
      <div class="notif-title">ATEN√á√ÉO ‚Äî COMPROMISSOS URGENTES</div>
      <div id="notif-lista"></div>
    </div>
  </div>

  <!-- STATS -->
  <div class="stats">
    <div class="stat c1"><span class="stat-icon">üìã</span><div class="stat-label">Total Agendado</div><div class="stat-val" id="st0">0</div></div>
    <div class="stat c2"><span class="stat-icon">üìÖ</span><div class="stat-label">Pr√≥ximos 7 dias</div><div class="stat-val" id="st1">0</div></div>
    <div class="stat c3"><span class="stat-icon">‚è∞</span><div class="stat-label">Vence Hoje/Amanh√£</div><div class="stat-val" id="st2">0</div></div>
    <div class="stat c4"><span class="stat-icon">üö®</span><div class="stat-label">Urgentes/Vencidos</div><div class="stat-val" id="st3">0</div></div>
  </div>

  <!-- FILTROS -->
  <div class="filtros">
    <button class="filtro-btn active" onclick="setFiltro('todos',this)">Todos</button>
    <button class="filtro-btn" onclick="setFiltro('low',this)">üü¢ Baixa</button>
    <button class="filtro-btn" onclick="setFiltro('med',this)">üü° M√©dia</button>
    <button class="filtro-btn" onclick="setFiltro('high',this)">üî¥ Urgente</button>
    <button class="filtro-btn" onclick="setFiltro('hoje',this)">üìÖ Hoje</button>
    <button class="filtro-btn" onclick="setFiltro('vencido',this)">‚ö†Ô∏è Vencidos</button>
  </div>

  <!-- MAIN -->
  <div class="main">

    <!-- FORM -->
    <div class="panel">
      <div class="panel-title"><div class="pulse"></div> Novo Agendamento</div>

      <div class="field">
        <label>Descri√ß√£o do trabalho *</label>
        <input type="text" id="i-tarefa" placeholder="EX: MANUTEN√á√ÉO CARRO 1010">
      </div>
      <div class="field">
        <label>Data do compromisso *</label>
        <input type="date" id="i-data">
      </div>
      <div class="field">
        <label>WhatsApp (55 + DDD + n√∫mero) *</label>
        <input type="text" id="i-fone" placeholder="5561999999999" maxlength="15">
      </div>
      <div class="field">
        <label>Observa√ß√£o / Detalhe</label>
        <textarea id="i-obs" placeholder="DETALHES ADICIONAIS (OPCIONAL)"></textarea>
      </div>
      <div class="field">
        <label>Prioridade</label>
        <div class="prio-row">
          <button class="prio-btn al" onclick="setPrio('low',this)">üü¢ BAIXA</button>
          <button class="prio-btn" onclick="setPrio('med',this)">üü° M√âDIA</button>
          <button class="prio-btn" onclick="setPrio('high',this)">üî¥ URGENTE</button>
        </div>
      </div>
      <button class="btn-save" onclick="salvar()">+ SALVAR AGENDAMENTO</button>
    </div>

    <!-- LIST -->
    <div>
      <div class="list-top">
        <div class="list-title">Compromissos</div>
        <div class="list-actions">
          <input class="search" type="text" id="i-busca" placeholder="üîç Buscar..." oninput="render()">
          <button class="btn-export" onclick="exportarPDF()">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
            EXPORTAR
          </button>
        </div>
      </div>
      <div id="lista"></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const KEY='AGENDA_ARARAAZUL_v3';
let prioAtual='low', filtroAtual='todos', isDark=true;
const PC={low:'#00D4A0',med:'#FFB800',high:'#FF3B5C'};

function get(){try{return JSON.parse(localStorage.getItem(KEY))||[];}catch{return[];}}
function set(d){localStorage.setItem(KEY,JSON.stringify(d));}
function dias(ds){const h=new Date();h.setHours(0,0,0,0);return Math.round((new Date(ds+'T00:00:00')-h)/86400000);}
function fmt(ds){if(!ds)return'';const[y,m,d]=ds.split('-');return`${d}/${m}/${y}`;}

/* CLOCK */
setInterval(()=>{
  const n=new Date(),p=v=>String(v).padStart(2,'0');
  document.getElementById('clock').textContent=`${p(n.getDate())}/${p(n.getMonth()+1)}/${n.getFullYear()} ¬∑ ${p(n.getHours())}:${p(n.getMinutes())}:${p(n.getSeconds())}`;
},1000);

/* TEMA */
function toggleTheme(){
  isDark=!isDark;
  document.body.className=isDark?'dark':'light';
  document.getElementById('btn-theme').textContent=isDark?'‚òÄÔ∏è CLARO':'üåô ESCURO';
}

/* PRIO */
function setPrio(v,el){
  prioAtual=v;
  document.querySelectorAll('.prio-btn').forEach(b=>b.className='prio-btn');
  el.classList.add(v==='low'?'al':v==='med'?'am':'ah');
}

/* FILTRO */
function setFiltro(v,el){
  filtroAtual=v;
  document.querySelectorAll('.filtro-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  render();
}

/* TOAST */
function toast(msg,tipo='ok'){
  const t=document.getElementById('toast');
  t.textContent=msg; t.className=`toast ${tipo} show`;
  setTimeout(()=>t.classList.remove('show'),2800);
}

/* NOTIFICA√á√ïES */
function checarNotif(){
  const dados=get();
  const urgentes=dados.filter(i=>dias(i.data)<=1&&dias(i.data)>=-3);
  const banner=document.getElementById('notif-banner');
  const lista=document.getElementById('notif-lista');
  if(urgentes.length){
    banner.classList.add('show');
    lista.innerHTML=urgentes.map(i=>{
      const d=dias(i.data);
      const label=d<0?`Vencido h√° ${Math.abs(d)} dia(s)`:d===0?'Vence HOJE':d===1?'Vence AMANH√É':'';
      return `<div class="notif-item">‚Ä¢ ${i.tarefa} ‚Äî <strong>${label}</strong></div>`;
    }).join('');
  } else {
    banner.classList.remove('show');
  }
}

/* SALVAR */
function salvar(){
  const t=document.getElementById('i-tarefa').value.trim().toUpperCase();
  const d=document.getElementById('i-data').value;
  const f=document.getElementById('i-fone').value.trim().replace(/\D/g,'');
  const o=document.getElementById('i-obs').value.trim().toUpperCase();
  if(!t||!d||!f){toast('‚ö† Preencha todos os campos obrigat√≥rios','err');return;}
  if(f.length<10){toast('‚ö† N√∫mero de telefone inv√°lido','err');return;}
  const novo=[...get(),{tarefa:t,data:d,fone:f,obs:o,prio:prioAtual}];
  set(novo);
  document.getElementById('i-tarefa').value='';
  document.getElementById('i-data').value='';
  document.getElementById('i-fone').value='';
  document.getElementById('i-obs').value='';
  setPrio('low',document.querySelector('.prio-btn'));
  toast('‚úì Agendamento salvo com sucesso!','ok');
  render();
}

/* APAGAR */
function apagar(idx){
  if(!confirm('Excluir este agendamento?'))return;
  const d=get(); d.splice(idx,1); set(d);
  toast('Registro exclu√≠do','info'); render();
}

/* EDITAR */
function toggleEdit(idx){
  const form=document.getElementById('ef-'+idx);
  const card=document.getElementById('card-'+idx);
  const isOpen=form.classList.contains('open');
  document.querySelectorAll('.edit-form.open').forEach(f=>f.classList.remove('open'));
  document.querySelectorAll('.card.editing').forEach(c=>c.classList.remove('editing'));
  if(!isOpen){form.classList.add('open');card.classList.add('editing');}
}

function confirmarEdit(idx){
  const dados=get();
  const t=document.getElementById('et-'+idx).value.trim().toUpperCase();
  const d=document.getElementById('ed-'+idx).value;
  const f=document.getElementById('ef2-'+idx).value.trim().replace(/\D/g,'');
  const o=document.getElementById('eo-'+idx).value.trim().toUpperCase();
  const p=document.getElementById('ep-'+idx).value;
  if(!t||!d||!f){toast('‚ö† Preencha todos os campos','err');return;}
  dados[idx]={...dados[idx],tarefa:t,data:d,fone:f,obs:o,prio:p};
  set(dados); toast('‚úì Agendamento atualizado!','ok'); render();
}

/* EXPORTAR PDF */
function exportarPDF(){
  const dados=get();
  if(!dados.length){toast('Nenhum dado para exportar','err');return;}
  const rows=dados.map((i,n)=>`
    <tr style="border-bottom:1px solid #eee;">
      <td style="padding:8px 12px;">${n+1}</td>
      <td style="padding:8px 12px;font-weight:600;">${i.tarefa}</td>
      <td style="padding:8px 12px;">${fmt(i.data)}</td>
      <td style="padding:8px 12px;">${i.fone}</td>
      <td style="padding:8px 12px;">${i.prio==='high'?'üî¥ URGENTE':i.prio==='med'?'üü° M√âDIA':'üü¢ BAIXA'}</td>
      <td style="padding:8px 12px;font-size:12px;color:#666;">${i.obs||'‚Äî'}</td>
    </tr>`).join('');
  const html=`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Agenda Rio Novo</title>
  <style>body{font-family:sans-serif;padding:32px;color:#111;}h1{font-size:22px;margin-bottom:4px;}p{color:#666;font-size:13px;margin-bottom:24px;}table{width:100%;border-collapse:collapse;}th{background:#060B14;color:#fff;padding:10px 12px;text-align:left;font-size:12px;letter-spacing:1px;}</style>
  </head><body>
  <h1>üìã AGENDA RIO NOVO</h1>
  <p>Excel√™ncia em Movimento ‚Äî Araraazul ¬∑ Emitido em ${new Date().toLocaleDateString('pt-BR')}</p>
  <table><thead><tr><th>#</th><th>TAREFA</th><th>DATA</th><th>WHATSAPP</th><th>PRIORIDADE</th><th>OBS</th></tr></thead>
  <tbody>${rows}</tbody></table></body></html>`;
  const w=window.open('','_blank');
  w.document.write(html); w.document.close(); w.print();
  toast('‚úì Abrindo para impress√£o/PDF','ok');
}

/* RENDER */
function render(){
  const dados=get();
  const busca=document.getElementById('i-busca').value.toLowerCase();

  const em7=dados.filter(i=>{const d=dias(i.data);return d>=0&&d<=7;}).length;
  const hojAm=dados.filter(i=>{const d=dias(i.data);return d===0||d===1;}).length;
  const urg=dados.filter(i=>dias(i.data)<0||i.prio==='high').length;
  document.getElementById('st0').textContent=dados.length;
  document.getElementById('st1').textContent=em7;
  document.getElementById('st2').textContent=hojAm;
  document.getElementById('st3').textContent=urg;

  checarNotif();

  let filtrados=dados.map((item,i)=>({...item,origIdx:i}))
    .filter(i=>{
      if(busca&&!i.tarefa.toLowerCase().includes(busca)&&!(i.obs||'').toLowerCase().includes(busca))return false;
      if(filtroAtual==='low')return i.prio==='low';
      if(filtroAtual==='med')return i.prio==='med';
      if(filtroAtual==='high')return i.prio==='high';
      if(filtroAtual==='hoje')return dias(i.data)===0;
      if(filtroAtual==='vencido')return dias(i.data)<0;
      return true;
    })
    .sort((a,b)=>a.data.localeCompare(b.data));

  const lista=document.getElementById('lista');
  if(!filtrados.length){
    lista.innerHTML=`<div class="empty"><div class="empty-icon">üìã</div><p>NENHUM COMPROMISSO ENCONTRADO</p></div>`;
    return;
  }

  let lastDate='',html='';
  filtrados.forEach(item=>{
    const d=dias(item.data);
    const label=d<0?`Vencido h√° ${Math.abs(d)}d`:d===0?'HOJE':d===1?'AMANH√É':`Em ${d} dias`;
    const sCls=d<0?'p-urg':d===0?'p-hj':d===1?'p-am':'';
    const pCls=item.prio==='high'?'p-hi':item.prio==='med'?'p-med':'p-low';
    const pLabel=item.prio==='high'?'üî¥ URGENTE':item.prio==='med'?'üü° M√âDIA':'üü¢ BAIXA';
    const sc=PC[item.prio]||'#00D4A0';
    const msg=encodeURIComponent(`üìã AVISO OPERACIONAL ‚Äî ARARAAZUL\n\nTAREFA: ${item.tarefa}\n${item.obs?'DETALHE: '+item.obs+'\n':''}PRAZO: ${fmt(item.data)}\n\nSistema Agenda Rio Novo`);
    const link=`https://wa.me/${item.fone}?text=${msg}`;
    const idx=item.origIdx;

    if(item.data!==lastDate){
      html+=`<div class="section-date"><span>${fmt(item.data)}</span><span style="font-size:9px;">${d<0?'VENCIDO':d===0?'HOJE':d===1?'AMANH√É':d+' DIAS'}</span></div>`;
      lastDate=item.data;
    }

    html+=`
    <div class="card" id="card-${idx}">
      <div class="card-stripe" style="background:${sc};"></div>
      <div style="min-width:0;">
        <div class="card-name">${item.tarefa}</div>
        <div class="meta-row">
          <span class="pill ${sCls}">${label}</span>
          <span class="pill">${item.fone}</span>
          <span class="pill ${pCls}">${pLabel}</span>
        </div>
        ${item.obs?`<div class="card-obs">${item.obs}</div>`:''}
        <!-- EDIT FORM -->
        <div class="edit-form" id="ef-${idx}">
          <div class="edit-row">
            <input class="edit-inp" id="et-${idx}" value="${item.tarefa}" placeholder="TAREFA" style="grid-column:1/-1;">
          </div>
          <div class="edit-row">
            <input type="date" class="edit-inp" id="ed-${idx}" value="${item.data}">
            <input class="edit-inp" id="ef2-${idx}" value="${item.fone}" placeholder="WHATSAPP">
          </div>
          <input class="edit-inp" id="eo-${idx}" value="${item.obs||''}" placeholder="OBSERVA√á√ÉO" style="width:100%;margin-bottom:8px;">
          <select class="edit-inp" id="ep-${idx}" style="width:100%;margin-bottom:8px;">
            <option value="low" ${item.prio==='low'?'selected':''}>üü¢ BAIXA</option>
            <option value="med" ${item.prio==='med'?'selected':''}>üü° M√âDIA</option>
            <option value="high" ${item.prio==='high'?'selected':''}>üî¥ URGENTE</option>
          </select>
          <div class="edit-actions">
            <button class="btn-confirm" onclick="confirmarEdit(${idx})">‚úì SALVAR</button>
            <button class="btn-cancel-edit" onclick="toggleEdit(${idx})">CANCELAR</button>
          </div>
        </div>
      </div>
      <div class="card-actions">
        <a href="${link}" target="_blank" class="btn-wa">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.125.55 4.117 1.516 5.849L.057 23.886a.5.5 0 0 0 .609.61l6.102-1.48A11.945 11.945 0 0 0 12 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 21.6a9.555 9.555 0 0 1-4.868-1.332l-.349-.207-3.622.878.904-3.55-.228-.364A9.555 9.555 0 0 1 2.4 12C2.4 6.698 6.698 2.4 12 2.4S21.6 6.698 21.6 12 17.302 21.6 12 21.6z"/></svg>
          WA
        </a>
        <button class="btn-edit" onclick="toggleEdit(${idx})">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          EDITAR
        </button>
        <button class="btn-del" onclick="apagar(${idx})">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
          DEL
        </button>
      </div>
    </div>`;
  });
  lista.innerHTML=html;
}

window.onload=render;
</script>
</body>
</html>
